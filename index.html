<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <link rel="shortcut icon" href="https://amir248.github.io/localhost/hh.svg">
    <title>news Page</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
  </head>
  <body>
    <main>
      <article class="">
        <h1>oK</h1>
        <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
        <form action="http://nasobe.ru/comments/post" method="post" name="registerForm">
          <fieldset>
            <legend>login</legend>
            <input type="text" name="login" value="">
          </fieldset>
          <fieldset>
            <legend>message</legend>
            <input type="text" name="message" value="">
          </fieldset>
          <!-- <button type="submit" name="button" id='submit'>Go</button> -->
          <button type="button" id='start' name="button">Fetch</button>
        </form>
        <div id="comments"></div>
      </article>
      <script type="text/javascript">



            const put2='/files/text.json';
            const put3='https://nasobe.ru/comments/post';

  document.querySelector('#start').addEventListener('click',()=>{
    var myHeaders = new Headers();
    myHeaders.append("Content-Type", "application/json;charset=utf-8");

    let userNameF=registerForm.elements['login'].value;
    let messageF=registerForm.elements['message'].value;

    const user = {
      userName: userNameF,
      message: messageF,
      date : new Date()
    }
    // var urlencoded = new URLSearchParams();
    // urlencoded.append("userName", `${user.userName}`);

    var requestOptions = {
        mode: "cors", // no-cors, *cors, same-origin
        cache: "no-cache", // *default, no-cache, reload, force-cache, only-if-cached
        credentials: "omit", // include, *same-origin, omit
        redirect: "follow", // manual, *follow, error
        referrerPolicy: "no-referrer", // no-referrer, *no-referrer-when-downgrade, origin, origin-when-cross-origin, same-origin, strict-origin, strict-origin-when-cross-origin, unsafe-url
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },

      body:JSON.stringify(user),
      // redirect: 'follow',
      // 'API-Key': 'secret'
    };


fetch(put3, requestOptions)
  .then(response => response.text())
  .then(result => console.log(result))
  .catch(error => console.log('error', error));

});//addEventListenerClick



const json ='https://nasobe.ru/comments/json/git.json';
function comments(){
  fetch(json,{
    origin: "https://amir248.github.io/",
  method: "POST",
  headers: {
    'Content-Type': 'application/json; charset=UTF-8'
  },
  // body: undefined,
  referrer: "https://amir248.github.io/",
  referrerPolicy: "no-referrer-when-downgrade",
  mode:"no-cors", //CORS - разрешены политикой cors
  credentials: "omit",
  cache: "no-store",

}).then(res=>res.json()).then(message=>{
  console.log(JSON.stringify(message));

// let ws = new WebSocket("ws://https://nasobe.ru/comments/");
//   ws.onmessage = ({data}) => {
//     // data = message;
//     console.log(data);
//     let message = JSON.parse(data);
//     console.log(message);
//       let count=message.length;
//       let num=-1+count+0;
//
//     for(num;num>=0;num--){
//       // console.log(message[num]['userName']);
//       // console.log(message[num]['message']);
//       // console.log(message[num]['date']);
//       let newUser=document.createElement('p');
//       newUser.innerHTML="<div style='color:red;float:left;font-size:25px;'><span style='color:orange;font-size:20px;'>NickName: </span>"+message[num]['userName']+"</div>";
//       document.querySelector('#comments').append(newUser);
//       let newMessage=document.createElement('p');
//       newMessage.innerHTML="<div style='color:grey;font-size:20px;'><span style='color:green;font-size:20px;'>Message: </span>"+message[num]['message']+"</div>";
//       document.querySelector('#comments').append(newMessage);
//       let newDate=document.createElement('p');
//       newDate.innerHTML="<div style='color:blue;float:right;'><span style='color:violet;font-size:18px;'>Date: </span>"+message[num]['date']+"</div>";
//       document.querySelector('#comments').append(newDate);
//     }
//     // document.querySelector('#date').innerHTML="<p style='border:1px solid lightgray; border-radius:2px;'>"+`${new Date()}`+"</p>";
//   }//we.message

});
console.log('LOL');
}
comments();
// setInterval(comments,3000);

      </script>
    </main>
  </body>
</html>
